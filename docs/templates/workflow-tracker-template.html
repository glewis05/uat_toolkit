<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UAT Tracker Template</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect } = React;

    // =====================================================
    // CONFIGURATION - Customize for each UAT
    // =====================================================
    const UAT_CONFIG = {
      id: 'template',
      name: 'UAT Template',
      target_date: '2025-01-01',
      tester_default: '',
      tester_email: '',
      formspree_id: null,  // Set to enable email submission
      localStorage_key: 'uat_template_tracker'
    };

    // =====================================================
    // WORKFLOW SECTIONS - Define the testing flow
    // =====================================================
    const WORKFLOW_SECTIONS = [
      {
        code: 'SECTION1',
        name: 'Section 1 Name',
        description: 'What this section covers',
        guidance: 'Step-by-step instructions for the tester on how to approach this section...',
        icon: 'üìã'
      },
      // Add more sections...
    ];

    // =====================================================
    // TEST CASES DATA - Organized by workflow section
    // =====================================================
    const TEST_CASES_DATA = [
      {
        test_id: 'TEST-001',
        title: 'Test title',
        workflow_section: 'SECTION1',
        workflow_order: 1,
        test_type: 'happy_path',  // happy_path, negative, validation, edge_case
        test_steps: '1. Do this\n2. Then this',
        expected_results: 'What should happen',
        context_hint: 'When you reach the X field...',  // Contextual hint
        priority: 'Must Have'
      },
      // Add more tests...
    ];

    // =====================================================
    // COMPONENT: Section Header with Guidance
    // =====================================================
    const SectionHeader = ({ section, tests, isExpanded, onToggle }) => {
      const sectionTests = tests.filter(t => t.workflow_section === section.code);
      const completed = sectionTests.filter(t => t.test_status !== 'Not Run').length;
      const passed = sectionTests.filter(t => t.test_status === 'Pass').length;
      const failed = sectionTests.filter(t => t.test_status === 'Fail').length;
      const total = sectionTests.length;
      const pct = total > 0 ? Math.round((completed / total) * 100) : 0;

      return (
        <div className="bg-white rounded-lg shadow mb-4">
          <button
            onClick={onToggle}
            className="w-full p-4 text-left flex items-center justify-between hover:bg-gray-50"
          >
            <div className="flex items-center gap-3">
              <span className="text-2xl">{section.icon}</span>
              <div>
                <h2 className="text-lg font-semibold text-gray-800">{section.name}</h2>
                <p className="text-sm text-gray-500">{section.description}</p>
              </div>
            </div>
            <div className="flex items-center gap-4">
              <div className="text-right">
                <div className="text-sm font-medium">
                  <span className="text-green-600">{passed}‚úì</span>
                  {failed > 0 && <span className="text-red-600 ml-2">{failed}‚úó</span>}
                  <span className="text-gray-400 ml-2">{completed}/{total}</span>
                </div>
                <div className="w-24 h-2 bg-gray-200 rounded-full mt-1">
                  <div
                    className={`h-2 rounded-full ${pct === 100 ? 'bg-green-500' : 'bg-blue-500'}`}
                    style={{ width: `${pct}%` }}
                  />
                </div>
              </div>
              <span className={`transform transition-transform ${isExpanded ? 'rotate-180' : ''}`}>
                ‚ñº
              </span>
            </div>
          </button>

          {isExpanded && (
            <div className="px-4 pb-4">
              <div className="bg-blue-50 border-l-4 border-blue-400 p-3 mb-4">
                <p className="text-sm text-blue-800 font-medium">How to test this section:</p>
                <p className="text-sm text-blue-700 mt-1">{section.guidance}</p>
              </div>
            </div>
          )}
        </div>
      );
    };

    // =====================================================
    // COMPONENT: Test Case Row
    // =====================================================
    const TestCaseRow = ({ test, notes, onStatusChange, onNotesChange }) => {
      const [expanded, setExpanded] = useState(false);

      const typeColors = {
        'happy_path': 'bg-green-100 text-green-700',
        'negative': 'bg-red-100 text-red-700',
        'validation': 'bg-blue-100 text-blue-700',
        'edge_case': 'bg-purple-100 text-purple-700'
      };

      return (
        <div className={`border rounded-lg mb-2 ${test.test_status === 'Fail' ? 'border-red-300' : 'border-gray-200'}`}>
          <div className="p-3 flex items-center gap-3">
            {/* Status indicator */}
            <div className={`w-3 h-3 rounded-full ${
              test.test_status === 'Pass' ? 'bg-green-500' :
              test.test_status === 'Fail' ? 'bg-red-500' :
              test.test_status === 'Blocked' ? 'bg-amber-500' :
              test.test_status === 'Skipped' ? 'bg-blue-500' : 'bg-gray-300'
            }`} />

            {/* Test info */}
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 flex-wrap">
                <code className="text-xs text-gray-500">{test.test_id}</code>
                <span className={`text-xs px-2 py-0.5 rounded ${typeColors[test.test_type] || 'bg-gray-100'}`}>
                  {test.test_type.replace('_', ' ')}
                </span>
              </div>
              <p className="text-sm font-medium text-gray-800 mt-1">{test.title}</p>
              {test.context_hint && (
                <p className="text-xs text-gray-500 italic mt-1">üí° {test.context_hint}</p>
              )}
            </div>

            {/* Quick action buttons */}
            <div className="flex gap-1">
              <button
                onClick={() => onStatusChange(test.test_id, 'Pass')}
                className={`w-8 h-8 rounded ${test.test_status === 'Pass' ? 'bg-green-500 text-white' : 'bg-gray-100 hover:bg-green-100'}`}
                title="Pass"
              >‚úì</button>
              <button
                onClick={() => onStatusChange(test.test_id, 'Fail')}
                className={`w-8 h-8 rounded ${test.test_status === 'Fail' ? 'bg-red-500 text-white' : 'bg-gray-100 hover:bg-red-100'}`}
                title="Fail"
              >‚úó</button>
              <button
                onClick={() => onStatusChange(test.test_id, 'Blocked')}
                className={`w-8 h-8 rounded ${test.test_status === 'Blocked' ? 'bg-amber-500 text-white' : 'bg-gray-100 hover:bg-amber-100'}`}
                title="Blocked"
              >!</button>
              <button
                onClick={() => onStatusChange(test.test_id, 'Skipped')}
                className={`w-8 h-8 rounded ${test.test_status === 'Skipped' ? 'bg-blue-500 text-white' : 'bg-gray-100 hover:bg-blue-100'}`}
                title="Skip"
              >‚àí</button>
            </div>

            {/* Expand button */}
            <button
              onClick={() => setExpanded(!expanded)}
              className="text-gray-400 hover:text-gray-600 px-2"
            >
              {expanded ? '‚ñ≤' : '‚ñº'}
            </button>
          </div>

          {/* Expanded details */}
          {expanded && (
            <div className="px-3 pb-3 border-t bg-gray-50">
              <div className="grid md:grid-cols-2 gap-4 mt-3">
                <div>
                  <p className="text-xs font-medium text-gray-500 uppercase mb-1">Test Steps</p>
                  <pre className="text-sm text-gray-700 whitespace-pre-wrap bg-white p-2 rounded border">
                    {test.test_steps}
                  </pre>
                </div>
                <div>
                  <p className="text-xs font-medium text-gray-500 uppercase mb-1">Expected Results</p>
                  <pre className="text-sm text-gray-700 whitespace-pre-wrap bg-white p-2 rounded border">
                    {test.expected_results}
                  </pre>
                </div>
              </div>
              <div className="mt-3">
                <p className="text-xs font-medium text-gray-500 uppercase mb-1">Your Notes</p>
                <textarea
                  value={notes[test.test_id] || ''}
                  onChange={(e) => onNotesChange(test.test_id, e.target.value)}
                  placeholder="Add observations, issues found, or questions..."
                  className="w-full p-2 border rounded text-sm"
                  rows={2}
                />
              </div>
              {test.tested_date && (
                <p className="text-xs text-gray-400 mt-2">
                  Tested: {new Date(test.tested_date).toLocaleString()}
                </p>
              )}
            </div>
          )}
        </div>
      );
    };

    // =====================================================
    // COMPONENT: Progress Dashboard
    // =====================================================
    const ProgressDashboard = ({ tests }) => {
      const stats = {
        total: tests.length,
        passed: tests.filter(t => t.test_status === 'Pass').length,
        failed: tests.filter(t => t.test_status === 'Fail').length,
        blocked: tests.filter(t => t.test_status === 'Blocked').length,
        skipped: tests.filter(t => t.test_status === 'Skipped').length,
        notRun: tests.filter(t => t.test_status === 'Not Run').length
      };
      stats.executed = stats.total - stats.notRun;
      stats.pct = Math.round((stats.executed / stats.total) * 100);

      return (
        <div className="bg-white rounded-lg shadow p-4 mb-6">
          <div className="flex items-center justify-between mb-3">
            <span className="text-sm font-medium text-gray-600">Overall Progress</span>
            <span className="text-lg font-bold text-gray-800">{stats.pct}%</span>
          </div>

          {/* Progress bar */}
          <div className="h-4 bg-gray-200 rounded-full overflow-hidden flex">
            {stats.passed > 0 && (
              <div className="bg-green-500 h-full" style={{ width: `${(stats.passed/stats.total)*100}%` }} />
            )}
            {stats.failed > 0 && (
              <div className="bg-red-500 h-full" style={{ width: `${(stats.failed/stats.total)*100}%` }} />
            )}
            {stats.blocked > 0 && (
              <div className="bg-amber-500 h-full" style={{ width: `${(stats.blocked/stats.total)*100}%` }} />
            )}
            {stats.skipped > 0 && (
              <div className="bg-blue-500 h-full" style={{ width: `${(stats.skipped/stats.total)*100}%` }} />
            )}
          </div>

          {/* Stats */}
          <div className="flex justify-between mt-3 text-sm">
            <span className="text-green-600">‚úì {stats.passed} Pass</span>
            <span className="text-red-600">‚úó {stats.failed} Fail</span>
            <span className="text-amber-600">! {stats.blocked} Blocked</span>
            <span className="text-blue-600">‚àí {stats.skipped} Skipped</span>
            <span className="text-gray-400">‚óã {stats.notRun} Not Run</span>
          </div>
        </div>
      );
    };

    // =====================================================
    // MAIN APP COMPONENT
    // =====================================================
    const App = () => {
      // State - Test Cases
      const [testCases, setTestCases] = useState(() => {
        const saved = localStorage.getItem(UAT_CONFIG.localStorage_key);
        if (saved) {
          const parsed = JSON.parse(saved);
          return parsed.testCases || TEST_CASES_DATA.map(t => ({ ...t, test_status: 'Not Run' }));
        }
        return TEST_CASES_DATA.map(t => ({ ...t, test_status: 'Not Run' }));
      });

      // State - Notes
      const [notes, setNotes] = useState(() => {
        const saved = localStorage.getItem(UAT_CONFIG.localStorage_key);
        return saved ? JSON.parse(saved).notes || {} : {};
      });

      // State - Tester Name
      const [testerName, setTesterName] = useState(() => {
        const saved = localStorage.getItem(UAT_CONFIG.localStorage_key);
        return saved ? JSON.parse(saved).testerName || UAT_CONFIG.tester_default : UAT_CONFIG.tester_default;
      });

      // State - Expanded Sections
      const [expandedSections, setExpandedSections] = useState(
        WORKFLOW_SECTIONS.reduce((acc, s) => ({ ...acc, [s.code]: true }), {})
      );

      // State - Submission
      const [submitting, setSubmitting] = useState(false);
      const [submitted, setSubmitted] = useState(false);

      // State - Sync
      const [lastSyncTime, setLastSyncTime] = useState(() => {
        const saved = localStorage.getItem(UAT_CONFIG.localStorage_key);
        return saved ? JSON.parse(saved).lastSyncTime || null : null;
      });
      const [syncStatus, setSyncStatus] = useState(null); // 'syncing', 'synced', 'error'

      // Save to localStorage
      useEffect(() => {
        localStorage.setItem(UAT_CONFIG.localStorage_key, JSON.stringify({
          testCases, notes, testerName, lastSyncTime, lastUpdated: new Date().toISOString()
        }));
      }, [testCases, notes, testerName, lastSyncTime]);

      // =====================================================
      // SYNC PROGRESS FUNCTION
      // =====================================================
      const syncProgress = async (triggerType = 'manual') => {
        if (!UAT_CONFIG.formspree_id) {
          console.log('Formspree not configured, skipping sync');
          return;
        }

        const executed = testCases.filter(t => t.test_status !== 'Not Run').length;
        if (executed === 0 && triggerType !== 'manual') {
          // Don't auto-sync if nothing done yet
          return;
        }

        setSyncStatus('syncing');

        const pct = Math.round((executed / testCases.length) * 100);

        const payload = {
          _subject: `UAT Progress: ${UAT_CONFIG.name} - ${testerName} (${pct}%)`,
          sync_type: triggerType, // 'auto_open', 'auto_10pm', 'manual', 'final'
          tester: testerName,
          tester_email: UAT_CONFIG.tester_email || '',
          synced_at: new Date().toISOString(),
          progress: {
            total: testCases.length,
            executed: executed,
            remaining: testCases.length - executed,
            percent_complete: pct,
            passed: testCases.filter(t => t.test_status === 'Pass').length,
            failed: testCases.filter(t => t.test_status === 'Fail').length,
            blocked: testCases.filter(t => t.test_status === 'Blocked').length,
            skipped: testCases.filter(t => t.test_status === 'Skipped').length
          },
          sections: WORKFLOW_SECTIONS.map(section => {
            const sectionTests = testCases.filter(t => t.workflow_section === section.code);
            const sectionExecuted = sectionTests.filter(t => t.test_status !== 'Not Run').length;
            return {
              code: section.code,
              name: section.name,
              total: sectionTests.length,
              executed: sectionExecuted,
              percent: sectionTests.length > 0 ? Math.round((sectionExecuted / sectionTests.length) * 100) : 0,
              passed: sectionTests.filter(t => t.test_status === 'Pass').length,
              failed: sectionTests.filter(t => t.test_status === 'Fail').length
            };
          }),
          results: testCases.map(t => ({
            test_id: t.test_id,
            title: t.title,
            section: t.workflow_section,
            status: t.test_status,
            tested_date: t.tested_date || null,
            notes: notes[t.test_id] || ''
          }))
        };

        try {
          const response = await fetch(`https://formspree.io/f/${UAT_CONFIG.formspree_id}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(payload)
          });

          if (response.ok) {
            const now = new Date().toISOString();
            setLastSyncTime(now);
            setSyncStatus('synced');

            // Clear synced status after 3 seconds
            setTimeout(() => setSyncStatus(null), 3000);

            if (triggerType === 'manual') {
              alert('Progress synced successfully!');
            }
          } else {
            setSyncStatus('error');
            if (triggerType === 'manual') {
              alert('Sync failed. Please try again.');
            }
          }
        } catch (error) {
          console.error('Sync error:', error);
          setSyncStatus('error');
          if (triggerType === 'manual') {
            alert('Network error. Please check your connection.');
          }
        }
      };

      // =====================================================
      // AUTO-SYNC ON OPEN (>8 hours since last sync)
      // =====================================================
      useEffect(() => {
        const checkAutoSync = () => {
          if (!lastSyncTime) {
            // Never synced, don't auto-sync on first open
            return;
          }

          const hoursSinceSync = (Date.now() - new Date(lastSyncTime).getTime()) / (1000 * 60 * 60);

          if (hoursSinceSync >= 8) {
            console.log(`Auto-syncing: ${hoursSinceSync.toFixed(1)} hours since last sync`);
            syncProgress('auto_open');
          }
        };

        // Check after a short delay to let state settle
        const timer = setTimeout(checkAutoSync, 2000);
        return () => clearTimeout(timer);
      }, []); // Run once on mount

      // =====================================================
      // 10PM PST AUTO-SYNC CHECK
      // =====================================================
      useEffect(() => {
        const check10pmSync = () => {
          const now = new Date();

          // Convert to PST (UTC-8, or UTC-7 during DST)
          // Using a simple approximation - checking for ~10pm local Pacific time
          const pstOffset = -8; // Standard PST
          const utcHours = now.getUTCHours();
          const pstHour = (utcHours + pstOffset + 24) % 24;
          const pstMinute = now.getUTCMinutes();

          // If it's between 10:00pm and 10:05pm PST
          if (pstHour === 22 && pstMinute < 5) {
            // Check if we already synced today
            const today = now.toISOString().split('T')[0];
            const lastSyncDate = lastSyncTime ? lastSyncTime.split('T')[0] : null;

            if (lastSyncDate !== today) {
              // Show confirmation and sync
              if (confirm('It\'s 10pm - would you like to sync your progress?')) {
                syncProgress('auto_10pm');
              }
            }
          }
        };

        // Check every minute
        const interval = setInterval(check10pmSync, 60000);

        // Also check immediately on mount
        check10pmSync();

        return () => clearInterval(interval);
      }, [lastSyncTime]);

      // =====================================================
      // HANDLERS
      // =====================================================
      const handleStatusChange = (testId, status) => {
        setTestCases(prev => prev.map(t =>
          t.test_id === testId
            ? { ...t, test_status: status, tested_date: new Date().toISOString() }
            : t
        ));
      };

      const handleNotesChange = (testId, note) => {
        setNotes(prev => ({ ...prev, [testId]: note }));
      };

      const toggleSection = (code) => {
        setExpandedSections(prev => ({ ...prev, [code]: !prev[code] }));
      };

      const handleExport = () => {
        const data = {
          uat_config: UAT_CONFIG,
          tester: testerName,
          exported_at: new Date().toISOString(),
          summary: {
            total: testCases.length,
            executed: testCases.filter(t => t.test_status !== 'Not Run').length,
            passed: testCases.filter(t => t.test_status === 'Pass').length,
            failed: testCases.filter(t => t.test_status === 'Fail').length,
            blocked: testCases.filter(t => t.test_status === 'Blocked').length,
            skipped: testCases.filter(t => t.test_status === 'Skipped').length
          },
          results: testCases.map(t => ({
            test_id: t.test_id,
            title: t.title,
            workflow_section: t.workflow_section,
            test_status: t.test_status,
            tested_date: t.tested_date,
            notes: notes[t.test_id] || ''
          }))
        };

        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${UAT_CONFIG.id}_results_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
      };

      const handleSubmit = async () => {
        if (!UAT_CONFIG.formspree_id) {
          alert('Email submission not configured for this UAT.');
          return;
        }
        if (!testerName.trim()) {
          alert('Please enter your name before submitting.');
          return;
        }

        const executed = testCases.filter(t => t.test_status !== 'Not Run').length;
        if (executed === 0) {
          alert('No tests have been executed yet.');
          return;
        }

        if (!confirm(`Submit ${executed} test results as ${testerName}?\n\nThis is your FINAL submission.`)) {
          return;
        }

        setSubmitting(true);

        const pct = Math.round((executed / testCases.length) * 100);

        const payload = {
          _subject: `UAT FINAL: ${UAT_CONFIG.name} - ${testerName} (${pct}%)`,
          sync_type: 'final',
          tester: testerName,
          tester_email: UAT_CONFIG.tester_email || '',
          submitted_at: new Date().toISOString(),
          progress: {
            total: testCases.length,
            executed: executed,
            remaining: testCases.length - executed,
            percent_complete: pct,
            passed: testCases.filter(t => t.test_status === 'Pass').length,
            failed: testCases.filter(t => t.test_status === 'Fail').length,
            blocked: testCases.filter(t => t.test_status === 'Blocked').length,
            skipped: testCases.filter(t => t.test_status === 'Skipped').length
          },
          sections: WORKFLOW_SECTIONS.map(section => {
            const sectionTests = testCases.filter(t => t.workflow_section === section.code);
            const sectionExecuted = sectionTests.filter(t => t.test_status !== 'Not Run').length;
            return {
              code: section.code,
              name: section.name,
              total: sectionTests.length,
              executed: sectionExecuted,
              percent: sectionTests.length > 0 ? Math.round((sectionExecuted / sectionTests.length) * 100) : 0,
              passed: sectionTests.filter(t => t.test_status === 'Pass').length,
              failed: sectionTests.filter(t => t.test_status === 'Fail').length
            };
          }),
          results: testCases.map(t => ({
            test_id: t.test_id,
            title: t.title,
            section: t.workflow_section,
            status: t.test_status,
            tested_date: t.tested_date || null,
            notes: notes[t.test_id] || ''
          }))
        };

        try {
          const response = await fetch(`https://formspree.io/f/${UAT_CONFIG.formspree_id}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify(payload)
          });

          if (response.ok) {
            setSubmitted(true);
            setLastSyncTime(new Date().toISOString());
            alert('Results submitted successfully!\n\nThank you for completing the UAT.');
          } else {
            const error = await response.json().catch(() => ({}));
            alert(`Submission failed: ${error.error || 'Unknown error'}\n\nPlease use Export JSON instead.`);
          }
        } catch (error) {
          console.error('Submit error:', error);
          alert('Network error. Please check your connection and try again, or use Export JSON.');
        } finally {
          setSubmitting(false);
        }
      };

      const handleReset = () => {
        if (confirm('Reset all progress? This cannot be undone.')) {
          setTestCases(TEST_CASES_DATA.map(t => ({ ...t, test_status: 'Not Run' })));
          setNotes({});
          setSubmitted(false);
          setLastSyncTime(null);
        }
      };

      return (
        <div className="max-w-4xl mx-auto py-6 px-4">
          {/* Header */}
          <div className="bg-white rounded-lg shadow p-4 mb-6">
            <div className="flex flex-wrap items-center justify-between gap-4">
              <div>
                <a href="index.html" className="text-blue-500 text-sm hover:underline">‚Üê Back to UAT List</a>
                <h1 className="text-2xl font-bold text-gray-800">{UAT_CONFIG.name}</h1>
                <p className="text-sm text-gray-500">Target: {UAT_CONFIG.target_date}</p>
              </div>

              <div className="flex items-center gap-2 flex-wrap">
                <input
                  type="text"
                  value={testerName}
                  onChange={(e) => setTesterName(e.target.value)}
                  placeholder="Your name"
                  className="border rounded px-3 py-2 text-sm w-36"
                />

                {/* Sync Progress Button */}
                <button
                  onClick={() => syncProgress('manual')}
                  disabled={syncStatus === 'syncing'}
                  className={`px-3 py-2 rounded text-sm flex items-center gap-1 ${
                    syncStatus === 'syncing' ? 'bg-gray-300 text-gray-500' :
                    syncStatus === 'synced' ? 'bg-green-100 text-green-700' :
                    'bg-blue-100 text-blue-700 hover:bg-blue-200'
                  }`}
                  title={lastSyncTime ? `Last sync: ${new Date(lastSyncTime).toLocaleString()}` : 'Never synced'}
                >
                  {syncStatus === 'syncing' ? '‚è≥' : syncStatus === 'synced' ? '‚úì' : 'üì§'}
                  <span className="hidden sm:inline">{syncStatus === 'syncing' ? 'Syncing...' : 'Sync'}</span>
                </button>

                {/* Export Button */}
                <button onClick={handleExport} className="bg-gray-600 text-white px-3 py-2 rounded text-sm hover:bg-gray-700">
                  <span className="hidden sm:inline">üì• </span>Export
                </button>

                {/* Submit Button (final) */}
                {UAT_CONFIG.formspree_id && (
                  <button
                    onClick={handleSubmit}
                    disabled={submitting || submitted}
                    className={`px-3 py-2 rounded text-sm font-medium ${
                      submitted
                        ? 'bg-green-100 text-green-700'
                        : submitting
                          ? 'bg-gray-300 text-gray-500'
                          : 'bg-green-600 text-white hover:bg-green-700'
                    }`}
                  >
                    {submitted ? '‚úì Done' : submitting ? '...' : 'üìß Submit'}
                  </button>
                )}

                <button onClick={handleReset} className="text-red-500 text-sm hover:underline">
                  Reset
                </button>
              </div>
            </div>

            {/* Last Sync Info */}
            {lastSyncTime && (
              <p className="text-xs text-gray-400 mt-2 text-right">
                Last synced: {new Date(lastSyncTime).toLocaleString()}
              </p>
            )}
          </div>

          {/* Progress Dashboard */}
          <ProgressDashboard tests={testCases} />

          {/* Workflow Sections */}
          {WORKFLOW_SECTIONS.map(section => (
            <div key={section.code}>
              <SectionHeader
                section={section}
                tests={testCases}
                isExpanded={expandedSections[section.code]}
                onToggle={() => toggleSection(section.code)}
              />

              {expandedSections[section.code] && (
                <div className="ml-4 mb-6">
                  {testCases
                    .filter(t => t.workflow_section === section.code)
                    .sort((a, b) => a.workflow_order - b.workflow_order)
                    .map(test => (
                      <TestCaseRow
                        key={test.test_id}
                        test={test}
                        notes={notes}
                        onStatusChange={handleStatusChange}
                        onNotesChange={handleNotesChange}
                      />
                    ))
                  }
                </div>
              )}
            </div>
          ))}

          {/* Footer */}
          <div className="text-center text-gray-400 text-sm mt-8">
            <p>Propel Health UAT Toolkit</p>
            <p className="text-xs mt-1">Progress auto-saved to browser</p>
          </div>
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
